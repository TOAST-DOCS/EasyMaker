## Machine Learning > AI EasyMaker > コンソール使用ガイド

## ノートパソコン
機械学習の開発に必要なパッケージがインストールされているJupyterノートパソコンを作成し、管理します。

### ノートパソコンの作成
Jupyterノートパソコンを作成します。

- **イメージ**：ノートパソコンインスタンスにインストールされるOSイメージを選択します。
    - **コアタイプ**：イメージのCPU、GPUコアタイプが表示されます。
    - **フレームワーク**：イメージにインストールされたフレームワークが表示されます。
        - TENSORFLOW：TensorFlowディープラーニングフレームワークがインストールされたイメージです。
        - PYTORCH：PyTorchディープラーニングフレームワークがインストールされたイメージです。
        - PYTHON：ディープラーニングフレームワークがインストールされておらず、Python言語のみインストールされたイメージです。
    - **フレームワークバージョン**：イメージにインストールされたフレームワークのバージョンが表示されます。
    - **Pythonバージョン**：イメージにインストールされたPythonバージョンが表示されます。

- **ノートパソコン情報**
    - ノートパソコンの名前、説明を入力します。
    - ノートパソコンのインスタンスタイプを選択します。選択したタイプに基づいてインスタンスの仕様が選択されます。

- **ストレージ** 
    - ノートパソコンのブートストレージとデータストレージサイズを指定します。
        - ブートストレージは、Jupyterノートパソコンおよび基本仮想環境がインストールされるストレージです。このストレージはノートパソコンを再起動すると初期化されます。
        - データストレージは`/root/easymaker`ディレクトリパスにマウントされるブロックストレージです。このストレージのデータはノートパソコンを再起動しても維持されます。
    - 作成されたノートパソコンのストレージサイズは変更できませんので、作成時に十分なストレージサイズで指定してください。
    - ストレージサイズは10GB単位で、最大2,040GBまで入力できます。
    - 必要な場合はノートパソコンを接続する**NHN Cloud NAS**を追加できます。
        - マウントディレクトリ名：ノートパソコンにマウントするディレクトリ名を入力します。
        - NHN Cloud NASパス：`nas://{NAS ID}:/{path}`形式のディレクトリパスを入力します。

- **追加設定** 
    - タグ：Key-Value形式のタグを指定できます。タグは最大10個まで入力できます。


> **[注意] NHN Cloud NASを使用する場合**
> AI EasyMakerと同じプロジェクトで作成されたNHN Cloud NASのみ使用できます。

> **[参考]ノートパソコン作成所要時間**
> ノートパソコンの作成には数分かかる場合があります。
> 最初のリソース(ノートパソコン、学習、実験、エンドポイント)作成時、サービス環境構成のためにさらに数分かかる場合があります。

### ノートパソコンリスト
ノートパソコンリストが表示されます。リストのノートパソコンを選択すると、詳細情報を確認して情報を変更できます。

- **名前**：ノートパソコン名が表示されます。詳細画面で**変更**をクリックすると名前を変更できます。
- **状態**：ノートパソコンの状態が表示されます。主な状態は下表を参照してください。

    | 状態 | 説明 |
    | --- | --- |
    | CREATE REQUESTED | ノートパソコン作成がリクエストされた状態です。 |
    | CREATE IN PROGRESS | ノートパソコンインスタンスを作成中の状態です。 |
    | ACTIVE (HEALTHY) | ノートパソコンアプリケーションが正常に動作している状態です。 |
    | ACTIVE (UNHEALTHY) | ノートパソコンアプリケーションが正常に動作していない状態です。ノートパソコンを再起動した後にもこの状態が持続する場合はサポートにお問い合わせください。|
    | STOP IN PROGRESS | ノートパソコンを停止中の状態です。 |
    | STOPPED | ノートパソコンを停止した状態です。 |
    | START IN PROGRESS | ノートパソコンを起動中の状態です。 |
    | DELETE IN PROGRESS | ノートパソコンを削除中の状態です。 |
    | CREATE FAILED | ノートパソコンの作成中に失敗した状態です。作成が継続的に失敗する場合はサポートにお問い合わせください。|
    | STOP FAILED | ノートパソコンの停止に失敗した状態です。もう一度お試しください。 |
    | START FAILED | ノートパソコンの起動に失敗した状態です。もう一度お試しください。 |
    | DELETE FAILED | ノートパソコンの削除に失敗した状態です。もう一度お試しください。 |

- **作業 > Jupyterノートパソコンを開く**：**Jupyterノートパソコンを開く**ボタンをクリックすると、ブラウザの新しいウィンドウでノートパソコンを開きます。ノートパソコンはコンソールにログインしたユーザーのみアクセスできます。
- **タグ**：ノートパソコンのタグが表示されます。タグは **変更**をクリックして変更できます。

### ユーザー仮想実行環の境構成
AI EasyMakerノートパソコンインスタンスは、機械学習に必要なさまざまなライブラリおよびカーネルがインストールされた基本Conda仮想環境を提供します。
基本Conda仮想環境はノートパソコンを停止して起動する時に初期化されて動作しますが、ユーザーが任意のパスにインストールした仮想環境および外部ライブラリは自動的に初期化されないため、ノートパソコンを停止して起動する時に維持されません。
この問題を解決するには、`/root/easymaker/custom-conda-envs`ディレクトリパスに仮想環境を作成し、作成された仮想環境から外部ライブラリをインストールする必要があります。
AI EasyMakerノートパソコンインスタンスは`/root/easymaker/custom-conda-envs`ディレクトリパスに作成された仮想環境に対してノートパソコンを停止して起動する時に初期化されて動作するようにサポートします。

次のガイドを参照してユーザー仮想環境を構成してください。

1. コンソールノートパソコンメニューの**Jupyterノートパソコンを開く** > **Jupyterノートパソコン > Launcher > Terminal**をクリックします。
2. `/root/easymaker/custom-conda-envs`パスに移動します。
    
        cd /root/easymaker/custom-conda-envs
    
3. Python 3.8バージョンの`easymaker_env`という仮想環境を作成するには、次のように`conda create`コマンドを実行します。
    
        conda create --prefix ./easymaker_env python=3.8
    
4. 作成された仮想環境は`conda env list`コマンドで確認できます。 

        (base) root@nb-xxxxxx-0:~# conda env list
        # conda environments:
        #
                                /opt/intel/oneapi/intelpython/latest
                                /opt/intel/oneapi/intelpython/latest/envs/2022.2.1
        base                *   /opt/miniconda3
        easymaker_env           /root/easymaker/custom-conda-envs/easymaker_env
    
### ノートパソコンの停止
動作中のノートパソコンを停止するか、停止したノートパソコンを起動します。

1. ノートパソコンリストから起動または停止するノートパソコンを選択します。
2. **ノートパソコンの起動**または**ノートパソコンの停止**をクリックします。
3. リクエストされた作業はキャンセルできません。続行するには**[OK]**をクリックします。

> **[注意]ノートパソコンの停止後に起動時に仮想環境および外部ライブラリを維持する方法**
> ノートパソコンを停止して起動する時、ユーザーが作成した仮想環境および外部ライブラリが初期化されることがあります。
> 維持するには[ユーザー仮想実行環境の構成](./console-guide/??#_4)を参照してユーザー仮想環境を構成してください。


> **[参考]ノートパソコンの起動と停止の所要時間**
> ノートパソコンの起動と停止は数分かかる場合があります。

### ノートパソコンインスタンスタイプの変更 
作成されたノートパソコンのインスタンスタイプを変更します。
変更するインスタンスタイプは既存インスタンスと同じコアタイプのインスタンスタイプにのみ変更できます。

1. インスタンスタイプを変更するノートパソコンを選択します。
2. ノートパソコンが動作中の状態(ACTIVE)の場合は、**ノートパソコンの停止**をクリックしてノートパソコンを停止します。
3. **インスタンスタイプの変更**をクリックします。
4. 変更するインスタンスタイプを選択し、[OK]をクリックします。
    
> **[参考]インスタンスタイプ変更所要時間**
> インスタンスタイプの変更は数分かかる場合があります。

### ノートパソコンの削除 
作成されたノートパソコンを削除します。

1. リストから削除するノートパソコンを選択します。
2. **ノートパソコンの削除**をクリックします。
3. リクエストされた削除作業はキャンセルできません。続行するには**[OK]**をクリックします。

> **[参考]ストレージ**
> ノートパソコンを削除すると、ブートストレージとデータストレージが削除されます。
> 接続したNHN Cloud NASは削除されず、**NHN Cloud NAS**から個別に削除する必要があります。


## 学習
機械学習アルゴリズムを学習し、学習結果を統計で確認できる環境を提供します。

### 学習作成
学習が実行されるインスタンスとOSイメージを選択して学習が実行される環境を設定し、学習するアルゴリズム情報と入力/出力データパスを入力して学習を進めます。

- **基本情報**：学習の基本情報と学習が含まれる実験を選択します。
    - **学習名**：学習名を入力します。
    - **学習説明**：説明を入力します。
    - **実験**：学習が含まれる実験を選択します。実験は関連する学習をグループ化します。作成された実験がない場合は**追加**をクリックして実験を作成します。
- **アルゴリズム情報**：学習するアルゴリズムの情報を入力します。
    - **アルゴリズムパス**
        - **NHN Cloud Object Storage**：アルゴリズムが保存されているNHN Cloud Object Storageのパスを入力します。<br>
            - obs://{Object Storage APIエンドポイント}/{containerName}/{path}形式でディレクトリパスを入力します。
            - NHN Cloud Object Storageを利用する場合[付録 > 1. NHN Cloud Object StorageにAI EasyMakerシステムアカウント権限追加](./console-guide/??#1-nhn-cloud-object-storageai-easymaker)を参照して権限を設定してください。必要な権限を設定しない場合はモデルの作成に失敗します。
        - **NHN Cloud NAS**：アルゴリズムが保存されたNHN Cloud NASパスを入力します。<br>
            nas://{NAS ID}:/{path}形式でディレクトリパスを入力します。
            
    - **エントリーポイント**
        - エントリーポイントは学習が始まるアルゴリズム実行の引き込み点です。エントリーポイントファイル名を作成します。
        - エントリーポイントファイルはアルゴリズムパスに存在する必要があります。
        - 同じパスに**requirements.txt**を作成すると、スクリプトで必要なPythonパッケージがインストールされます。
    - **ハイパーパラメータ**
        - 学習用のパラメータを追加するには**+ボタン**をクリックしてKey-Value形式でパラメータを入力します。パラメータは最大100個まで入力できます。
        - 入力されたハイパーパラメータはエントリーポイントが実行される時に実行引数として入力されます。詳しい活用方法は[付録 > 3. 学習アルゴリズム作成ガイド](./console-guide/??#3)を参照してください。

- **イメージ**：学習を実行しなければならない環境に合わせてインスタンスのイメージを選択します。

- **学習インスタンス情報**
    - **学習インスタンスタイプ**：学習を実行するインスタンスタイプを選択します。
    - **学習インスタンス数**：学習を実行するインスタンス数を入力します。インスタンス数を2つ以上入力すると、学習の実行が並列で進行し、速く学習を完了できます。

- **データ情報**
    - **入力データ**：学習を実行するデータセットを入力します。データセットは最大10個まで設定できます。
        - データセット名：データセット名を入力します。
        - データパス：NHN Cloud Object StorageまたはNHN Cloud NASパスを入力します。
    - **出力データ**：学習の実行結果を保存するデータ保存パスを入力します。
        - NHN Cloud Object StorageまたはNHN Cloud NASパスを入力します。

- **追加設定**
    - **チェックポイント**：アルゴリズムがチェックポイントを提供する場合、チェックポイントの保存パスを入力します。
        - 作成されたチェックポイントは以前の学習から学習を再開する時に利用できます。
        - NHN Cloud Object StorageまたはNHN Cloud NASパスを入力します。
    - **データストレージサイズ**：学習を実行するインスタンスのデータストレージサイズを入力します。
        - NHN Cloud Object Storageを使用する場合にのみ使用されます。学習に必要なデータがすべて保存できるように十分なサイズを指定してください。
    - **最大学習時間**：学習が完了するまでの最大待機時間を指定します。最大待機時間を超えた学習は終了処理されます。
    - **ログ管理**：学習進行中に発生するログをNHN Cloud Log & Crashサービスに保存できます。 
        - 詳細は[付録 > 2. NHN Cloud Log & Crash Searchサービス利用案内およびログ確認](./console-guide/??#2-nhn-cloud-log-crash-search)を参照してください。
    - **タグ**：タグを追加するには**+ボタン**をクリックしてKey-Value形式でタグを入力します。タグは最大10個まで入力できます。

> **[注意] NHN Cloud NASを使用する場合**
> AI EasyMakerと同じプロジェクトで作成されたNHN Cloud NASのみ使用できます。

> **[注意]学習入力データを削除すると学習失敗**
> 学習が完了する前に入力データを削除すると、学習に失敗する可能性があります。

### 学習リスト
学習リストが表示されます。リストの学習を選択すると、詳細情報を確認して情報を変更できます。

- **説明**：学習の説明が表示されます。詳細画面で**変更**をクリックして説明を変更できます。
- **学習時間**：学習が進行された時間が表示されます。
- **状態**：学習の状態が表示されます。主な状態は下表を参照してください。

    | 状態 | 説明 |
    | --- | --- |
    | CREATE REQUESTED | 学習の作成をリクエストした状態です。 |
    | CREATE IN PROGRESS | 学習に必要なリソースを作成中の状態です。 |
    | RUNNING | 学習が進行中の状態です。 |
    | STOPPED | 学習がユーザーのリクエストで停止した状態です。 |
    | COMPLETE | 学習が正常に完了した状態です。 |
    | STOP IN PROGRESS | 学習が停止中の状態です。 |
    | FAIL TRAIN | 学習の進行中に失敗した状態です。詳細な失敗情報はログ管理が有効になっている場合は、Log & Crash Searchログで確認できます。|
    | CREATE FAILED | 学習の作成に失敗した状態です。作成が継続的に失敗する場合はサポートにお問い合わせください。|
    | FAIL TRAIN IN PROGRESS, COMPLETE IN PROGRESS | 学習に使用されたリソースを整理中の状態です。 |
    
- **作業**
    - **Tensorboard**：学習の統計情報を確認できるTensorboardがブラウザの新しいウィンドウで開きます。<br/>
    Tensorboardログを残す方法は[付録 > 3. 学習アルゴリズム作成ガイド](./console-guide/??#3)を参照してください。Tensorboardはコンソールにログインしたユーザーのみ接続できます。
    - **学習の停止**：進行中の学習を停止できます。

- **ハイパーパラメータ**：学習を選択すると、表示される詳細画面の**ハイパーパラメータ**タブで学習に設定したハイパーパラメータ値を確認できます。

### 学習のコピー
既存の学習と同じ設定で新しい学習を作成します。

1. コピーする学習を選択します。
2. **学習のコピー**をクリックします。
3. 既存の学習と同じ設定で学習作成画面が表示されます。
4. 設定を変更する情報がある場合は、変更した後に**学習の作成**をクリックして学習を作成します。

### 学習からモデルを作成する
完了した状態の学習でモデルを作成します。

1. モデルとして作成する学習を選択します。
2. **モデルの作成**をクリックします。完了(COMPLETE)状態の学習のみモデルとして作成できます。
3. モデル作成ページに移動します。内容を確認し、**モデルの作成**をクリックしてモデルを作成します。
モデル作成の詳細については[モデル](./console-guide/??#_19)文書を参照してください。


### 学習の削除
学習を削除します。

1. 削除する学習を選択します。
2. **学習の削除**をクリックします。進行中の学習は停止後に削除できます。
3. リクエストされた削除作業はキャンセルできません。続行するには**[OK]**をクリックします。

> **[参考]関連するモデルが存在する場合は学習の削除不可**
> 削除する学習で作成されたモデルが存在する場合は学習を削除できません。モデルを先に削除してから学習を削除してください。

## 実験
実験は、関連する学習を実験にグループ化して管理します。

### 実験の作成

1. **実験の作成**をクリックします。
2. 実験名と説明を入力し、**確認**をクリックします。

> **[参考]実験作成の所要時間**
> 実験の作成は数分かかる場合があります。
> 最初のリソース(ノートパソコン、学習、実験、エンドポイント)作成時、サービス環境構成のためにさらに数分かかる場合があります。

### 実験リスト
実験リストが表示されます。リストの実験を選択すると、詳細情報を確認して情報を変更できます。

- **状態**：実験の状態が表示されます。主な状態は下表を参照してください。

    | 状態 | 説明 |
    | --- | --- |
    | CREATE IN PROGRESS | 実験が作成中の状態です。 |
    | CREATE RESOURCE IN PROGRESS | 実験が作成中の状態です。 |
    | CREATE EXPERIMENT IN PROGRESS | 実験が作成中の状態です。 |
    | ACTIVE | 実験が正常に作成された状態です。 |
    | FAILED TO CREATE RESOURCE | 実験の作成に失敗した状態です。もう一度お試しください。 |
    | FAILED TO CREATE EXPERIMENT | 実験の作成に失敗した状態です。もう一度お試しください。 |

- **作業**
    - **Tensorboard**をクリックすると、実験に含まれる学習の統計情報を確認できるTensorboardがブラウザ新しいウィンドウで開きます。Tensorboardはコンソールにログインしたユーザーのみ接続できます。
    - **再試行**:実験状態が失敗(FAIL)の場合、**再試行**をクリックして実験を復旧できます。
- **学習**：学習を選択すると、表示される詳細画面の**学習**タブは実験に含まれる学習のリストが表示されます。


### 実験の削除
実験を削除します。

1. 削除する実験を選択します。
2. **実験の削除**をクリックします。実験が作成中の状態の場合は実験を削除できません。
3. リクエストされた削除作業はキャンセルできません。続行するには**[OK]**をクリックします。

> **[参考]関連する学習が存在する場合は実験の削除不可**
> 実験に関連する学習が存在する場合は実験を削除できません。先に関連する学習を削除してから実験を削除してください。
> 関連する学習は、削除したい実験をクリッすると表示される下部の詳細画面で**[学習]**タブをクリックしてリストを確認できます。


## モデル 
AI EasyMakerの学習結果のモデルまたは外部のモデルをアーティファクトとして管理できます。

### モデルの作成

- **基本情報**：モデルの基本情報を入力します。
    - **名前**：モデル名を入力します。
        - モデルのフレームワークの種類がPyTorchの場合、PyTorchモデル名と同じモデル名を入力する必要があります。
    - **説明**：モデルの説明を入力します。
- **フレームワーク情報**：モデルのフレームワーク情報を入力します。
    - **フレームワーク**：モデルのフレームワークをTensorFlowまたはPyTorchから選択します。
    - **フレームワークバージョン**：モデルフレームワークのバージョンを入力します。
- **モデル情報**：モデルのアーティファクトが保存されているリポジトリを入力します。
    - **NHN Cloud Object Storage**：モデルアーティファクトが保存されているObject Storageパスを入力します。
        - `obs://{Object Storage APIエンドポイント}/{containerName}/{path}`形式でディレクトリパスを入力します。
        - NHN Cloud Object Storageを利用する場合、[付録 > 1. NHN Cloud Object StorageにAI EasyMakerシステムアカウント権限を追加](./console-guide/??#1-nhn-cloud-object-storageai-easymaker)を参考にして権限を設定してください。権限を設定していない場合、モデルのアーティファクトにアクセスができず、モデルの作成に失敗します。
    - **NHN Cloud NAS**：モデルアーティファクトが保存されているNHN Cloud NASパスを入力します。
        - `nas://{NAS ID}:/{path}`形式でディレクトリパスを入力します。
- **追加設定**：モデルの追加情報を入力します。
    - **タグ**：タグを追加するには**+ボタン**をクリックしてKey-Value形式でタグを入力します。タグは最大10個まで入力できます。

> **[注意] NHN Cloud NASを使用する場合**
> AI EasyMakerと同じプロジェクトで作成されたNHN Cloud NASのみ使用できます。

> **[注意]リポジトリのモデルアーティファクトを維持**
> リポジトリに保存されているモデルアーティファクトを維持しない場合、該当モデルのエンドポイント作成が失敗します。

### モデルリスト 
モデルリストが表示されます。リストのモデルを選択すると詳細情報を確認して情報を変更できます。

- **名前**：モデル名と説明が表示されます。モデル名と説明は**変更**をクリックして変更できます。
- **タグ**：モデルのタグが表示されます。タグは **変更**をクリックして変更できます。
- **モデルアーティファクトパス**：モデルのアーティファクトが保存されているリポジトリが表示されます。
- **学習名**：学習で作成されたモデルの場合、もとになる学習の名前が表示されます。
- **学習ID**：学習で作成されたモデルの場合、もとになる学習のIDが表示されます。
- **フレームワーク**：モデルのフレームワーク情報が表示されます。


### モデルでエンドポイントを作成する
選択したモデルをサービスできるエンドポイントを作成します。

1. エンドポイントとして作成するモデルをリストから選択します。
2. **エンドポイントの作成**をクリックします。
3. **エンドポイントの作成**ページに移動します。内容を確認し、**エンドポイントの作成**をクリックしてモデルを作成します。
エンドポイントの作成の詳細については[エンドポイント](./console-guide/??#_24)文書を参照してください。


### モデルの削除 
モデルを削除します。

1. リストから削除するモデルを選択します。
2. **モデルの削除**をクリックします。
3. リクエストされた削除作業はキャンセルできません。続行するには**[OK]**をクリックします。

> **[参考]関連するエンドポイントが存在する場合はモデル削除不可**
> 削除しようとしているモデルで作成されたエンドポイントが存在する場合、モデルを削除できません。
> 削除するには先に該当モデルで作成されたエンドポイントを削除してからモデルを削除してください。


## エンドポイント
モデルをサービスできるエンドポイントを作成し、管理します。

### エンドポイントの作成

- **API Gatewayサービスの有効化**
    - AI EasyMakerエンドポイントはNHN Cloud API Gatewayサービスを介してAPIエンドポイントを作成し、APIを管理します。エンドポイント機能を利用するにはAPI Gatewayサービスを必ず有効にする必要があります。
    - API Gatewayサービスの詳細と料金については、次の文書を確認してください。
        - [API Gatewayサービス案内](https://docs.toast.com/ko/Data%20&%20Analytics/Log%20&%20Crash%20Search/ko/Overview/)
        - [API Gateway利用料金](https://www.toast.com/kr/pricing/by-service?c=Data%20%26%20Analytics&s=Log%20%26%20Crash%20Search)
- **エンドポイント**：新規または既存エンドポイントにステージを追加するかどうかを選択します。
    - **新規エンドポイントとして作成**：新規エンドポイントを作成します。API Gatewayに新規サービスと基本ステージでエンドポイントが作成されます。
    - **既存エンドポイントから新規ステージ追加**：既存エンドポイントのAPI Gatewayのサービスに新規ステージとしてエンドポイントが作成されます。ステージを追加する既存エンドポイントを選択します。
- **エンドポイント名**：エンドポイントの名前を入力します。エンドポイント名は重複できません。
- **ステージ名**：既存エンドポイントから新規ステージを追加する場合、新規ステージ名を入力します。ステージ名は重複できません。
- **説明**：エンドポイントステージの説明を入力します。
- **モデル情報**：エンドポイントに配布するモデルアーティファクトの情報を入力します。
    - **モデル**：エンドポイントに配布するモデルを選択します。モデルを作成していない場合は、モデルを先に作成してください。
    - **API Gatewayリソースパス**：配布されるモデルのAPIリソースパスを入力します。例えば`/inference`と設定した場合、`POST https://{enpdoint-domain}/inference`で推論APIをリクエストできます。
- **インスタンス情報**：モデルがサービスされるインスタンス情報を入力します。
    - **インスタンスタイプ**：インスタンスタイプを選択します。
    - **インスタンス数**：インスタンスの動作数を入力します。
- **追加設定 > タグ**：タグを追加するには**+ ボタン**をクリックしてKey-Value形式でタグを入力します。タグは最大10個まで入力できます。

> **[参考]エンドポイント作成所要時間**
> エンドポイントの作成には数分かかる場合があります。
> 最初のリソース(ノートパソコン、学習、実験、エンドポイント)作成時、サービス環境構成のためにさらに数分かかります。

> **[参考]エンドポイント作成時のAPI Gatewayサービスリソース提供制約**
> 新規エンドポイントを作成すると、API Gatewayサービスを新規作成します。
> 既存エンドポイントから新規ステージを追加すると、API Gatewayサービスに新規ステージを作成します。
> [API Gatewayサービスリソース提供ポリシー](https://docs.toast.com/ko/TOAST/ko/resource-policy/#api-gateway)のリソース提供ポリシーを超えた場合、AI EasyMakerでのエンドポイント作成ができません。この場合はAPI Gatewayサービスリソースクォーターを調整してください。

### エンドポイントリスト
エンドポイントリストが表示されます。リストのエンドポイントを選択すると、詳細情報を確認して情報を変更できます。

- **基本ステージURL**：エンドポイントのステージのうち、基本ステージのURLが表示されます。
- **状態**：エンドポイントの状態です。主な状態は下表を参照してください。

    | 状態 | 説明 |
    | --- | --- |
    | CREATE REQUESTED | エンドポイントの作成がリクエストされた状態です。 |
    | CREATE IN PROGRESS | エンドポイントを作成中の状態です。 |
    | UPDATE IN PROGRESS | エンドポイントのステージの一部が処理中の作業がある状態です。<br/>エンドポイントステージリストでステージごとの作業状態を確認できます。|
    | DELETE IN PROGRESS | エンドポイントを削除中の状態です。 |
    | ACTIVE | エンドポイントが正常に動作中の状態です。 |
    | CREATE FAILED | エンドポイントの作成に失敗した状態です。<br/>エンドポイントを削除してからもう一度作成する必要があります。作成失敗状態が繰り返される場合はサポートにお問い合わせください。|
    | UPDATE FAILED | エンドポイントのステージの一部が正常にサービスされていない状態です。問題となるステージを削除してもう一度作成する必要があります。 |

- **API Gateway状態**：エンドポイント基本ステージのAPI Gateway状態情報が表示されます。主な状態は下表を参照してください。
    
    | 状態 | 説明 |
    | --- | --- |
    | CREATE IN PROGRESS |  API Gatewayリソースを作成中の状態です。 |
    | STAGE DEPLOYING |  API Gateway基本ステージが配布中の状態です。 |
    | ACTIVE |  API Gateway基本ステージが正常に配布され、有効な状態です。 |
    | NOT FOUND: STAGE | エンドポイントの基本ステージが見つからない状態です。<br/>API Gatewayコンソールでステージが存在することを確認してください。<br/>ステージが削除された場合、削除されたAPI Gatewayステージは復元できず、エンドポイントを削除してからもう一度作成する必要があります。|
    | NOT FOUND: STAGE DEPLOY RESULT | エンドポイント基本ステージの配布状態が見つからない状態です。<br/>API Gatewayコンソールで基本ステージが配布された状態であることを確認してください。|
    | STAGE DEPLOY FAIL |  API Gateway基本ステージが配布失敗した状態です。<br/>**[参考]ステージのAPI Gateway「配布失敗」状態の場合の復旧方法**を参照して配布失敗状態を復旧できます。|
    

### エンドポイントステージの作成
既存のエンドポイントに新規ステージを追加します。新規ステージを作成して基本ステージの影響を受けずに新規ステージをテストできます。

1. エンドポイントリストで**エンドポイント名**をクリックします。
2. **+ ステージ作成**をクリックします。
3. 既存エンドポイントで新規ステージ追加が自動選択され、設定方法はエンドポイント作成内容と同じです。
4. リクエストされた削除作業はキャンセルできません。続行するには**[OK]**をクリックします。

### エンドポイントステージリスト
エンドポイント下位に作成されたステージリストが表示されます。リストのステージを選択すると詳細情報を確認できます。

- **状態**：エンドポイントステージの状態が表示されます。主な状態は下表を参照してください。

    | 状態 | 説明 |
    | --- | --- |
    | CREATE REQUESTED | エンドポイントステージの作成がリクエストされた状態です。 |
    | CREATE IN PROGRESS | エンドポイントステージを作成中の状態です。 |
    | DEPLOY IN PROGRESS | エンドポイントステージにモデルを配布中の状態です。 |
    | DELETE IN PROGRESS | エンドポイントステージを削除中の状態です。 |
    | ACTIVE | エンドポイントステージが正常に動作中の状態です。 |
    | CREATE FAILED | エンドポイントステージの作成に失敗した状態です。もう一度お試しください。 |
    | DEPLOY FAILED | エンドポイントステージの配布に失敗した状態です。もう一度作成してみてください。 |

- **API Gateway状態**：エンドポイントステージが配布されたAPI Gatewayのステージ状態が表示されます。
- **ステージ基本ステージかどうか**：基本ステージかどうかが表示されます。
- **ステージURL**：モデルがサービスされたAPI GatewayのステージURLが表示されます。
- **ステージエンドポイントURL**：ステージに配布されたモデルのエンドポイントURLです。APIクライアントは表示されたURLでAPIをリクエストできます。
- **API Gateway設定表示**：AI EasyMakerがAPI Gatewayステージに配布した設定を確認するには、**設定表示**をクリックします。
- **API Gateway統計表示**：エンドポイントのAPI統計を表示するには**統計表示**をクリックします。
- **モデルID/名前/アーティファクトパス**：ステージに配布されたモデルの情報を表示します。
- **インスタンスタイプ**：モデルがサービスされるエンドポイントインスタンスタイプが表示されます。
- **実行中のワークノード/Pod数**：エンドポイントで使用中のノードとPod数が表示されます。

> **[注意] AI EasyMakerが作成したAPI Gatewayの設定変更時の注意点**
> AI EasyMakerはエンドポイント作成またはエンドポイントステージ作成を行うと、エンドポイントに対するAPI Gatewayのサービスとステージを作成します。
> AI EasyMakerによって作成されたAPI GatewayサービスとステージをAPI Gatewayサービスコンソールで直接変更作業を行う場合、次の注意事項を必ず参照してください。
> 1. AI EasyMakerが作成したAPI Gatewayサービスとステージを削除しないようにします。削除すると、エンドポイントにAPI Gateway情報が正常に表示されず、エンドポイントの変更事項がAPI Gatewayに適用されない場合があります。
> 2. エンドポイント作成時に入力したAPI Gatewayリソースパスのリソースを変更または削除しないようにします。削除すると、エンドポイントの推論APIの呼び出しに失敗する場合があります。
> 3. エンドポイント作成時に入力したAPI Gatewayリソースパス下位にリソースを追加しないようにします。追加したリソースはエンドポイントステージ追加/変更作業時に削除される場合があります。
> 4. API Gatewayのステージ設定でAPI Gatewayリソースパスに設定された**バックエンドエンドポイントURL再定義**を無効にするか、URLを変更しないようにします。変更すると、エンドポイントの推論API呼び出しに失敗する可能性があります。
> 上記の注意事項以外の設定は、必要に応じてAPI Gatewayで提供する機能を利用できます。
> API Gatewayの詳細については[API Gatewayコンソールガイド](https://docs.toast.com/ja/Data%20&%20Analytics/Log%20&%20Crash%20Search/ja/console-guide/)を参照してください。

> **[参考]ステージのAPI Gateway 「配布失敗」状態の場合の復旧方法**
> 一時的な問題でAI EasyMakerエンドポイントのステージ設定がAPI Gatewayステージに配布されていない場合、配布失敗状態と表示されます。
> この場合、ステージリストからステージ選択 > 下部の詳細画面のAPI Gateway設定表示 > 「ステージ配布」をクリックしてAPI Gatewayステージを手動で配布できます。
> 上記のガイドでも配布状態が回復しない場合はサポートにお問い合わせください。

### エンドポイント推論の呼び出し

1. エンドポイント > エンドポイントステージでステージをクリックすると、下部にステージ詳細画面が表示されます。
2. 詳細画面のステージエンドポイントURLを確認します。
3. HTTP POST MethodでステージエンドポイントURLを呼び出すと、推論APIが呼び出されます。
    - ユーザーが作成したアルゴリズムによって推論APIのリクエスト、レスポンス仕様は異なります。

        // 推論API例：リクエスト 
        curl --location --request POST '{ステージエンドポイントURL}' \
        --header 'Content-Type: application/json' \
        --data-raw '{
            "instances": [
                [6.8,  2.8,  4.8,  1.4],
                [6.0,  3.4,  4.5,  1.6]
            ]
        }'
        
        // 推論API例：レスポンス 
        {
            "predictions" : [
                [
                    0.337502569,
                    0.332836747,
0.329660654
                ],
                [
                    0.337530434,
                    0.332806051,
0.329663515
                ]
            ]
        }


### エンドポイントの基本ステージ変更

エンドポイントの基本ステージを他のステージに変更します。
サービスの瞬断なしでエンドポイントのモデルを変更するには、AI EasyMakerはステージ機能を活用してモデルを配布することを推奨します。

1. 実際のサービスで運営中のステージは基本ステージで運営します。
2. 新規モデルに交換する場合、既存エンドポイントに新規ステージを追加します。
3. 新規ステージで交換されたモデルでエンドポイントサービスに問題がないことを確認します。
4. **基本ステージの変更**をクリックします。
5. 基本ステージに変更する新規ステージを、変更するステージから選択します。
6. 変更リクエスト作業はキャンセルできません。続行するには**[OK]**をクリックします。
7. 変更するステージが基本ステージに変更され、既存基本ステージのリソースは自動的に削除されます。

### エンドポイントステージの削除

1. エンドポイントリストで**エンドポイント名**をクリックしてエンドポイントステージリストに移動します。
2. エンドポイントステージリストから削除するエンドポイントステージを選択します。基本ステージは削除できません。
3. **ステージの削除**をクリックします。
4. リクエストされた削除作業はキャンセルできません。続行するには**[OK]**をクリックします。

> **[注意]エンドポイントステージを削除するとAPI Gatewayサービスのステージ削除**
> AI EasyMakerのエンドポイントステージを削除すると、エンドポイントのステージが配布されたAPI Gatewayサービスのステージも削除されます。
> 削除されるAPI Gatewayステージに運営中のAPIが存在する場合、API呼び出しができませんので注意してください。

### エンドポイントの削除
エンドポイントを削除します。

1. エンドポイントリストから削除するエンドポイントを選択します。
2. エンドポイント下位に基本ステージを除くステージが存在する場合、エンドポイントを削除できません。先に他のステージを削除してからエンドポイントを削除してください。
3. **エンドポイントの削除**をクリックします。
4. リクエストされた削除作業はキャンセルできません。続行するには**[OK]**をクリックします。

> **[注意]エンドポイントを削除するとAPI Gatewayサービス削除**
> AI EasyMakerのエンドポイントを削除すると、エンドポイントが配布されたAPI Gatewayサービスも削除されます。
> 削除されるAPI Gatewayサービスに運営中のAPIが存在する場合、API呼び出しができませんので注意してください。


## 付録

### 1. NHN Cloud Object StorageにAI EasyMakerシステムアカウント権限を追加

AI EasyMakerの一部機能で入出力ストレージとしてユーザーのNHN Cloud Object Storageを使用する場合、
ユーザーのNHN Cloud Object StroageコンテナにAI EasyMakerシステムアカウントへの読み取りまたは書き込み権限を許可した時のみ正常に機能が動作します。

ユーザーのNHN Cloud Object StroageコンテナにAI EasyMakerシステムアカウントの読み取り/書き込み権限を許可することは、AI EasyMakerシステムアカウントがユーザーのNHN Cloud Object Stroageコンテナのすべてのファイルに対して付与された権限に基づいてファイルの読み書きができることを意味します。

この内容を必ず確認して必要なアカウントと権限のみユーザーObject Storageにアクセスポリシーを設定する必要があります。

アクセスポリシー設定中にAI EasyMakerシステムアカウント以外のアカウントに対してユーザーのObject Storageアクセスを許可して発生したすべての結果に対する責任は「ユーザー」にあり、AI EasyMakerはそれに対して責任を負いません。

[参考]機能によってAI EasyMakerがObject Stroageにアクセスして読み書きするファイルは次のとおりです。

| 機能 | 権限 | アクセス対象 |
| --- | --- | --- |
| 学習 | 読み取り | ユーザーが入力したアルゴリズムパス、学習入力データパス |
| 学習 | 書き込み | ユーザーが入力した学習出力データ、チェックポイントパス|
| モデル | 読み取り | ユーザーが入力したモデルアーティファクトパス |
| エンドポイント | 読み取り | ユーザーが入力したモデルアーティファクトパス |

NHN Cloud Object StorageにAI EasyMakerシステムアカウントの読み取り/書き込み権限を追加するには、次の内容を参照してください。

1. **[学習]**または**[モデル]**タブ > **AI EasyMakerシステムアカウント情報**をクリックします。 
2. AI EasyMakerシステムアカウント情報の**AI EasyMakerテナントID**と**AI EasyMaker APIユーザーID**をアーカイブします。 
3. NHN Cloud Object Storageコンソールに移動します。
4. [特定プロジェクトまたは特定ユーザーに読み取り/書き込み許可](https://docs.toast.com/ja/Storage/Object%20Storage/ja/acl-guide/#_4)文書を参照してNHN Cloud Object StorageコンソールでAI EasyMakerシステムアカウントに必要な読み取りおよび書き込み許可権限を追加します。


### 2. NHN Cloud Log & Crash Searchサービス利用案内およびログ照会方法

#### NHN Cloud Log & Crash Searchサービスの利用案内
AI EasyMakerサービスで発生するログ、イベントをNHN Cloud Log & Crash Searchサービスに保存できます。
Log & Crash Searchサービスにログを保存するには、Log & Crashサービスを有効にする必要があり、別途利用料金がかかります。

- **Log & Crash Searchサービス利用および料金案内** 
    - Log & Crash Searchサービスの詳細内容と料金は、次の文書を確認してください。 
        - [Log & Crash Searchサービス案内](https://docs.toast.com/ja/Data%20&%20Analytics/Log%20&%20Crash%20Search/ja/Overview/)
        - [Log & Crash Search利用料金](https://www.toast.com/kr/pricing/by-service?c=Data%20%26%20Analytics&s=Log%20%26%20Crash%20Search)

#### ログ照会

1. Log & Crash Searchサービスコンソールページに移動します。
2. Log & Crash Searchサービスで検索条件を入力してログを照会します。
    * AI EasyMaker学習ログクエリ：categoryフィールドが"easymaker.training"のログを照会します。
        * クエリ： category:"easymaker.training"
    * AI EasyMakerエンドポイントログクエリ：categoryフィールドが"easymaker.inference"のログを照会します。
        * クエリ： category:"easymaker.inference"
    * AI EasyMakerログ全体照会クエリ： logTypeフィールドが"NNHCloud-AIEasyMaker"のログを照会します。
        * クエリ：logType:"NHNCloud\-AIEasyMaker"
3. Log & Crash Searchサービスの詳細な利用方法は[Log & Crash Searchサービスのコンソールガイド](https://docs.toast.com/ja/Data%20&%20Analytics/Log%20&%20Crash%20Search/ja/console-guide/)を参照してください。

AI EasyMakerサービスは、Log & Crash Searchサービスに次のように定義されたフィールドにログを転送します。

- **共通ログフィールド** 

    | 名前 | 説明 | 有効範囲 |
    | --- | --- | --- | 
    | easymakerAppKey | AI EasyMakerアプリケーションキー(AppKey) | - |
    | category | ログカテゴリー | easymaker.training, easymaker.inference |
    | logLevel | ログレベル | INFO, WARNING, ERROR |
    | body | ログの内容 | - |
    | logType | ログ提供サービス名 | NHNCloud-AIEasyMaker |
    | time | ログ発生時間(UTC時刻) | - |

- **学習ログフィールド**

    | 名前 | 説明 |
    | --- | --- |
    | trainingId | AI EasyMaker学習ID |

- **エンドポイントログフィールド**

    | 名前 | 説明 |
    | --- | --- | 
    | endpointId | AI EasyMakerエンドポイントID |
    | endpointStageId | エンドポイントステージID | 
    | inferenceId | 推論リクエスト固有ID | 
    | action | Action区分(リクエスト： Inference.Request、レスポンス：Inference.Response) | 
    | modelName | 推論対象モデル名 | 

### 3. 学習アルゴリズム作成ガイド
学習に使用されるアルゴリズムスクリプトの作成と結果指標を確認するために必要な方法を説明します。

#### ハイパーパラメータ

* コンソールから入力されたKey-Value形式の値です。
* エントリーポイント実行時、実行引数として渡されます。

以下の例のように、学習作成時に入力したハイパーパラメータの値を活用できます。<br>
![ハイパーパラメータの入力画面](http://static.toastoven.net/prod_ai_easymaker/console-guide_appendix_hyperparameter_ja.png)

        import argparse

        def parse_hyperparameters():
            parser = argparse.ArgumentParser()

            # 入力したハイパーパラメータ解析
            parser.add_argument("--epochs", type=int, default=500)
            parser.add_argument("--batch_size", type=int, default=32)
            parser.add_argument("--model_version", type=str, default="1.0.0")
            ...

            return parser.parse_known_args()

#### 環境変数

* 学習に必要な情報は、**環境変数**として学習コンテナに渡され、**学習スクリプト**で渡された環境変数を活用できます。
* ユーザー入力で作成される環境変数名は大文字に変換されます。
* **主な環境変数**

    | 環境変数名 | 説明 |
    | --- | --- |
    | EM_SOURCE_DIR | 学習作成時に入力したアルゴリズムスクリプトがダウンロードされているフォルダの絶対パス |
    | EM_ENTRY_POINT | 学習作成時に入力したアルゴリズムエントリーポイント名 |
    | EM_DATASET_${データセット名} | 学習作成時に入力したそれぞれのデータセットがダウンロードされているフォルダの絶対パス |
    | EM_DATASETS | 全体データセットリスト(json形式) |
    | EM_MODEL_DIR | モデル保存パス |
    | EM_CHECKPOINT_DIR | チェックポイント保存パス |
    | EM_HP_${ハイパーパラメータキー} | ハイパーパラメータキーに対応するハイパーパラメータ値 |
    | EM_HPS | 全体ハイパーパラメータリスト(json形式) |
    | EM_TENSORBOARD_LOG_DIR | 学習結果を確認するためのTensorboardログパス |
    | EM_REGION | 現在のリージョン情報 |
    | EM_APPKEY | 現在使用中のAI EasyMakerサービスのアプリケーションキー |

* **環境変数活用サンプルコード**

        import os

        dataset_dir = os.environ.get("EM_DATASET_TRAIN")
        train_data = read_data(dataset_dir, "train.csv")

        model = ... # 入力したデータを利用してモデル実装

        model_dir = os.environ.get("EM_MODEL_DIR")
        model.save(model_dir)

#### Tensorboardを活用するための指標ログを保存

* 学習後、Tensorboard画面で結果指標を確認するために、学習スクリプト作成時にTensorboardログ記憶領域を指定された位置(`EM_TENSORBOARD_LOG_DIR`)に設定する必要があります。

* **Tensorboardログ保存のサンプルコード(TensorFlow)**

        import tensorflow as tf

        # Tensorboardログパスの指定
        tb_log = tf.keras.callbacks.TensorBoard(log_dir=os.environ.get("EM_TENSORBOARD_LOG_DIR"))

        model = ... # モデル実装

        model.fit(x_train, y_train, validation_data=(x_test, y_test),
                epochs=100, batch_size=20, callbacks=[tb_log])

![Tensorboardログ確認](http://static.toastoven.net/prod_ai_easymaker/console-guide_appendix_tensorboard.png)
